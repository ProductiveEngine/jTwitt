


CREATE TABLE APP_USER
( USER_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY CONSTRAINT USER_PK PRIMARY KEY,
  USERNAME VARCHAR(50) NOT NULL,
  PASSWORD VARCHAR(50) NOT NULL,
  FIRST_NAME VARCHAR(50) NOT NULL,
  LAST_NAME VARCHAR(50) NOT NULL,
  EMAIL VARCHAR(50) NOT NULL,
  CREATE_DATE TIMESTAMP NOT NULL, 
  NUM_OF_FOLLOWERS INT NOT NULL DEFAULT 0,
  NUM_OF_FOLLOWING INT NOT NULL DEFAULT 0,
  NUM_OF_TWEETS INT NOT NULL DEFAULT 0
  );



CREATE TABLE FOLLOWER
(
FOLLOWER_USER_ID INT NOT NULL,
FOLLOWING_USER_ID INT NOT NULL ,
IS_ACTIVE SMALLINT NOT NULL DEFAULT 1,
CONSTRAINT FOLLOWER_PK PRIMARY KEY (FOLLOWER_USER_ID , FOLLOWING_USER_ID),
CONSTRAINT FOLLOWER_FK FOREIGN KEY (FOLLOWER_USER_ID ) REFERENCES APP_USER (USER_ID) ON DELETE CASCADE,
CONSTRAINT FOLLOWING_FK FOREIGN KEY (FOLLOWING_USER_ID ) REFERENCES APP_USER (USER_ID) ON DELETE CASCADE
);


CREATE TABLE TWEET
(  TWEET_ID INT NOT NULL GENERATED ALWAYS AS IDENTITY CONSTRAINT TWEET_PK PRIMARY KEY, 
   USER_ID INT NOT NULL,
   TWEET VARCHAR(140),
   REPLY_ID INT ,
   CREATE_DATE TIMESTAMP NOT NULL,
   MODIFY_DATE TIMESTAMP ,
   CONSTRAINT USER_FK FOREIGN KEY (USER_ID) REFERENCES APP_USER(USER_ID) ON DELETE CASCADE
);


CREATE TABLE FAV_TWEET
(  USER_ID INT NOT NULL,
   TWEET_ID INT NOT NULL,
   OWNER_ID INT NOT NULL,
   CONSTRAINT FAV_TWEET_PK PRIMARY KEY ( USER_ID, TWEET_ID),
   CONSTRAINT FAV_USER_FK FOREIGN KEY (USER_ID ) REFERENCES APP_USER (USER_ID) ON DELETE CASCADE,
   CONSTRAINT FAV_TWEET_FK FOREIGN KEY (TWEET_ID ) REFERENCES TWEET (TWEET_ID) ON DELETE CASCADE
);

CREATE TABLE RE_TWEET
(  USER_ID INT NOT NULL,
   TWEET_ID INT NOT NULL,
   CONSTRAINT RE_TWEET_PK PRIMARY KEY ( USER_ID, TWEET_ID),
   CONSTRAINT RE_USER_FK FOREIGN KEY (USER_ID ) REFERENCES APP_USER (USER_ID) ON DELETE CASCADE,
   CONSTRAINT RE_TWEET_FK FOREIGN KEY (TWEET_ID ) REFERENCES TWEET (TWEET_ID) ON DELETE CASCADE
);




ALTER TABLE APP_USER ADD CONSTRAINT USERNAME_UQ UNIQUE (USERNAME);
ALTER TABLE APP_USER ADD CONSTRAINT EMAIL_UQ UNIQUE (EMAIL);

---------------------------------------------------------------------------------------------------
